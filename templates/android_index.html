<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Androidæ€§èƒ½ç›‘æ§å¯è§†åŒ–</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f7;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #1d1d1f;
            margin-bottom: 10px;
        }
        .controls, .chart-container, .thread-distribution {
            position: relative;
            cursor: move;
            transition: transform 0.2s ease;
        }
        
        .controls h3::before, .chart-container h3::before, .thread-distribution h3::before {
            content: 'â‹®â‹®';
            position: absolute;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
            color: #ccc;
        }
        
        /* ç»Ÿè®¡é¢æ¿ç¦æ­¢æ‹–æ‹½ï¼Œç§»é™¤æ‹–æ‹½æ‰‹æŸ„ */
        .statistics-panel {
            position: relative;
            cursor: default;
        }
        
        .controls.dragging, .chart-container.dragging, .thread-distribution.dragging {
            transform: rotate(5deg);
            opacity: 0.8;
            z-index: 1000;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .controls h3 {
            margin-top: 0;
            color: #1d1d1f;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #424245;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
        /* æœç´¢æ¡†ç‰¹æ®Šæ ·å¼ */
        #appSearch {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="%23999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>');
            background-repeat: no-repeat;
            background-position: 12px center;
            background-size: 16px 16px;
            padding-left: 40px;
        }
        .btn {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-right: 10px;
        }
        .btn:hover {
            background: #0056cc;
        }
        .btn:disabled {
            background: #d2d2d7;
            cursor: not-allowed;
        }
        .btn.stop {
            background: #ff3b30;
        }
        .btn.stop:hover {
            background: #d32f2f;
        }
        .current-values {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .value-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .value-card .label {
            font-size: 12px;
            color: #86868b;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .value-card .value {
            font-size: 24px;
            font-weight: 600;
            color: #1d1d1f;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .chart-container h3 {
            margin: 0 0 20px 0;
            color: #1d1d1f;
            font-size: 18px;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        .statistics-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
        }
        .stat-card {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .stat-label {
            font-size: 12px;
            color: #86868b;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .stat-current {
            font-size: 20px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 5px;
        }
        .stat-details {
            font-size: 11px;
            color: #86868b;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .hidden {
            display: none;
        }
        .statistics-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .statistics-panel h3 {
            margin: 0 0 20px 0;
            color: #1d1d1f;
            font-size: 18px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
        }
        .stat-card {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .stat-label {
            font-size: 12px;
            color: #86868b;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .stat-current {
            font-size: 20px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 5px;
        }
        .stat-details {
            font-size: 11px;
            color: #86868b;
        }
        .thread-distribution {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .thread-distribution h3 {
            margin: 0 0 20px 0;
            color: #1d1d1f;
            font-size: 18px;
        }
        .thread-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e5e7;
            border-radius: 8px;
            background: #fafafa;
        }
        .thread-header {
            display: grid;
            grid-template-columns: 80px 1fr 120px 80px;
            gap: 10px;
            padding: 10px 15px;
            background: #f0f0f0;
            border-bottom: 1px solid #e5e5e7;
            font-weight: 600;
            font-size: 12px;
            color: #424245;
        }
        .thread-item {
            display: grid;
            grid-template-columns: 80px 1fr 120px 80px;
            gap: 10px;
            padding: 8px 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 11px;
            color: #1d1d1f;
        }
        .thread-item:hover {
            background: #f8f9fa;
        }
        .thread-item:last-child {
            border-bottom: none;
        }
        .thread-tid {
            font-family: monospace;
            font-weight: 600;
            color: #007aff;
        }
        .thread-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .thread-state {
            text-align: center;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }
        .thread-state.S {
            background: #d4edda;
            color: #155724;
        }
        .thread-state.R {
            background: #f8d7da;
            color: #721c24;
            animation: pulse 1.5s infinite;
        }
        .thread-state.D {
            background: #fff3cd;
            color: #856404;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .thread-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .thread-summary-card {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .thread-summary-label {
            font-size: 12px;
            color: #86868b;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .thread-summary-value {
            font-size: 24px;
            font-weight: 600;
            color: #1d1d1f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– Androidæ€§èƒ½ç›‘æ§å¯è§†åŒ–</h1>
            <p>å®æ—¶ç›‘æ§Androidåº”ç”¨çš„CPUã€å†…å­˜ã€FPSã€çº¿ç¨‹æ•°ç­‰æ€§èƒ½æŒ‡æ ‡</p>
        </div>

        <div id="status" class="status hidden"></div>

        <div class="controls" id="controls" draggable="true">
            <h3>ğŸ“± è®¾å¤‡ä¸åº”ç”¨æ§åˆ¶</h3>
            <div class="form-group">
                <label for="deviceSelect">é€‰æ‹©Androidè®¾å¤‡:</label>
                <select id="deviceSelect" onchange="onDeviceChanged()">
                    <option value="">è¯·å…ˆåˆ·æ–°è®¾å¤‡åˆ—è¡¨</option>
                </select>
                <button type="button" onclick="refreshDevices()" style="margin-left: 8px; padding: 8px 12px; border: 1px solid #007AFF; background: #007AFF; color: white; border-radius: 6px; cursor: pointer;">åˆ·æ–°è®¾å¤‡</button>
            </div>
            <div class="form-group">
                <label for="appSearch">æœç´¢åº”ç”¨:</label>
                <input type="text" id="appSearch" placeholder="è¾“å…¥åº”ç”¨åç§°æˆ–åŒ…åæœç´¢..." oninput="filterApps()">
            </div>
            <div class="form-group">
                <label for="packageSelect">é€‰æ‹©åº”ç”¨:</label>
                <select id="packageSelect" size="8" style="height: 200px;">
                    <option value="">è¯·å…ˆé€‰æ‹©è®¾å¤‡</option>
                </select>
                <button type="button" onclick="refreshApps()" style="margin-top: 8px; padding: 8px 12px; border: 1px solid #34C759; background: #34C759; color: white; border-radius: 6px; cursor: pointer;">åˆ·æ–°åº”ç”¨</button>
            </div>
            <div style="margin-top: 20px;">
                <button id="startBtn" class="btn" onclick="startMonitoring()">ğŸš€ å¼€å§‹ç›‘æ§</button>
                <button id="stopBtn" class="btn stop" onclick="stopMonitoring()" disabled>ğŸ›‘ åœæ­¢ç›‘æ§</button>
            </div>
        </div>

        <div class="current-values">
            <div class="value-card">
                <div class="label">åº”ç”¨CPUä½¿ç”¨ç‡</div>
                <div class="value" id="currentCpu">0%</div>
                <div style="font-size: 10px; color: #86868b; margin-top: 2px;">ç›¸å¯¹å•æ ¸</div>
            </div>
            <div class="value-card">
                <div class="label">æ•´æœºCPUä½¿ç”¨ç‡</div>
                <div class="value" id="currentSystemCpu">0%</div>
                <div style="font-size: 10px; color: #86868b; margin-top: 2px;">ç³»ç»Ÿæ€»ä½“</div>
            </div>
            <div class="value-card">
                <div class="label">åº”ç”¨å†…å­˜</div>
                <div class="value" id="currentMemory">0MB</div>
                <div style="font-size: 10px; color: #86868b; margin-top: 2px;" id="systemMemInfo">ç³»ç»Ÿ: 0/0MB</div>
            </div>
            <div class="value-card">
                <div class="label">å¸§ç‡</div>
                <div class="value" id="currentFps">0FPS</div>
            </div>
            <div class="value-card">
                <div class="label">çº¿ç¨‹æ•°</div>
                <div class="value" id="currentThreads">0</div>
            </div>
            <div class="value-card">
                <div class="label">ç£ç›˜è¯»å†™</div>
                <div class="value" id="currentDiskReads">0MB</div>
                <div style="font-size: 10px; color: #86868b; margin-top: 2px;">å†™: <span id="currentDiskWrites">0MB</span></div>
            </div>
        </div>

        <div class="statistics-panel" id="statisticsPanel" draggable="false">
            <h3>ğŸ“ˆ æ•°æ®ç»Ÿè®¡</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">CPUä½¿ç”¨ç‡</div>
                    <div class="stat-current" id="statCpuCurrent">0%</div>
                    <div class="stat-details">
                        å¹³å‡: <span id="statCpuAvg">0%</span> | 
                        æœ€å¤§: <span id="statCpuMax">0%</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å†…å­˜ä½¿ç”¨</div>
                    <div class="stat-current" id="statMemoryCurrent">0MB</div>
                    <div class="stat-details">
                        å¹³å‡: <span id="statMemoryAvg">0MB</span> | 
                        æœ€å¤§: <span id="statMemoryMax">0MB</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å¸§ç‡</div>
                    <div class="stat-current" id="statFpsCurrent">0FPS</div>
                    <div class="stat-details">
                        å¹³å‡: <span id="statFpsAvg">0FPS</span> | 
                        æœ€å°: <span id="statFpsMin">0FPS</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">çº¿ç¨‹æ•°</div>
                    <div class="stat-current" id="statThreadsCurrent">0</div>
                    <div class="stat-details">
                        å¹³å‡: <span id="statThreadsAvg">0</span> | 
                        æœ€å¤§: <span id="statThreadsMax">0</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ç£ç›˜è¯»å–</div>
                    <div class="stat-current" id="statDiskReadsCurrent">0MB</div>
                    <div class="stat-details">
                        å¹³å‡: <span id="statDiskReadsAvg">0MB</span> | 
                        æœ€å¤§: <span id="statDiskReadsMax">0MB</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ç£ç›˜å†™å…¥</div>
                    <div class="stat-current" id="statDiskWritesCurrent">0MB</div>
                    <div class="stat-details">
                        å¹³å‡: <span id="statDiskWritesAvg">0MB</span> | 
                        æœ€å¤§: <span id="statDiskWritesMax">0MB</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="chart-container" id="cpuChart-container" draggable="true">
            <h3>ğŸ“Š CPUä½¿ç”¨ç‡</h3>
            <div class="chart-wrapper" data-chart="cpu">
                <canvas id="cpuChart"></canvas>
            </div>
        </div>

        <div class="chart-container" id="memoryChart-container" draggable="true">
            <h3>ğŸ§  å†…å­˜ä½¿ç”¨é‡</h3>
            <div class="chart-wrapper" data-chart="memory">
                <canvas id="memoryChart"></canvas>
            </div>
        </div>

        <div class="chart-container" id="fpsChart-container" draggable="true">
            <h3>ğŸ® å¸§ç‡</h3>
            <div class="chart-wrapper" data-chart="fps">
                <canvas id="fpsChart"></canvas>
            </div>
        </div>

        <div class="chart-container" id="threadsChart-container" draggable="true">
            <h3>ğŸ§µ çº¿ç¨‹æ•°é‡</h3>
            <div class="chart-wrapper" data-chart="threads">
                <canvas id="threadsChart"></canvas>
            </div>
        </div>

        <div class="chart-container" id="diskReadsChart-container" draggable="true">
            <h3>ğŸ“¥ ç£ç›˜è¯»å–</h3>
            <div class="chart-wrapper" data-chart="disk_reads">
                <canvas id="diskReadsChart"></canvas>
            </div>
        </div>

        <div class="chart-container" id="diskWritesChart-container" draggable="true">
            <h3>ğŸ“¤ ç£ç›˜å†™å…¥</h3>
            <div class="chart-wrapper" data-chart="disk_writes">
                <canvas id="diskWritesChart"></canvas>
            </div>
        </div>

        <div class="thread-distribution" id="threadDistribution" draggable="true">
            <h3>ğŸ§µ çº¿ç¨‹åˆ†å¸ƒè¯¦æƒ…</h3>
            
            <div class="thread-summary">
                <div class="thread-summary-card">
                    <div class="thread-summary-label">æ€»çº¿ç¨‹æ•°</div>
                    <div class="thread-summary-value" id="totalThreads">0</div>
                </div>
                <div class="thread-summary-card">
                    <div class="thread-summary-label">è¿è¡Œä¸­ (R)</div>
                    <div class="thread-summary-value" id="runningThreads">0</div>
                </div>
                <div class="thread-summary-card">
                    <div class="thread-summary-label">ç¡çœ ä¸­ (S)</div>
                    <div class="thread-summary-value" id="sleepingThreads">0</div>
                </div>
                <div class="thread-summary-card">
                    <div class="thread-summary-label">å…¶ä»–çŠ¶æ€</div>
                    <div class="thread-summary-value" id="otherThreads">0</div>
                </div>
            </div>

            <div class="thread-list">
                <div class="thread-header">
                    <div>TID</div>
                    <div>çº¿ç¨‹åç§°</div>
                    <div>çŠ¶æ€</div>
                    <div>ç±»å‹</div>
                </div>
                <div id="threadListContent">
                    <div style="padding: 20px; text-align: center; color: #86868b; font-style: italic;">
                        å¼€å§‹ç›‘æ§åå°†æ˜¾ç¤ºçº¿ç¨‹ä¿¡æ¯...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='android_script.js') }}"></script>
</body>
</html>